<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Login / Cadastro</title>
</head>
<body>
<h2>Login</h2>
<input type="text" id="login-username" placeholder="Usuário">
<input type="password" id="login-password" placeholder="Senha">
<button onclick="login()">Entrar</button>

<h2>Cadastro</h2>
<input type="text" id="reg-username" placeholder="Usuário">
<input type="email" id="reg-email" placeholder="Email">
<input type="password" id="reg-password" placeholder="Senha">
<button onclick="register()">Cadastrar</button>

<script>
window.onload = () => {
    const user = localStorage.getItem("loggedUser");
    if(user) window.location.href = "index.html";
}

async function register() {
    const username = document.getElementById("reg-username").value;
    const email = document.getElementById("reg-email").value;
    const password = document.getElementById("reg-password").value;

    const res = await fetch("/register", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({username, email, password})
    });
    const data = await res.json();
    alert(data.msg);
    if(data.success){
        localStorage.setItem("loggedUser", username);
        window.location.href = "index.html";
    }
}

async function login() {
    const username = document.getElementById("login-username").value;
    const password = document.getElementById("login-password").value;

    const res = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({username, password})
    });
    const data = await res.json();
    alert(data.msg);
    if(data.success){
        localStorage.setItem("loggedUser", username);
        window.location.href = "index.html";
    }
}
</script>
</body>
</html>
